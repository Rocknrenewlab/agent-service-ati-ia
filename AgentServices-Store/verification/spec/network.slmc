/* -*- mode: Tuareg;-*- 
  Filename:    network.slmc
  Authors:     luciusmeredith                                                     
  Creation:    Sun Nov  8 11:46:16 2015 
  Copyright:   Not supplied
  Description:
  ------------------------------------------------------------------------ */

  defproc InitializeNetwork( vlist, ask, fcheck ) = 
    vlist?( k, s ).(
      (new go in
	(new stop in (
	  ask!(stop,go)
	| select {
	    stop?(stake).(
	      (new kp in
		(new sp in
		  (new v in
		    (new betList in
		      (new updateBet in
			(new weightedBet in
			  (new rslt in
			    (s!(v,stake,betList,updateBet,weightedBet,rslt)
			    | Validator(v, updateBet, weightedBet, vlist, betList, rslt)
			    | WeightedAverage(fcheck, updateBet, vsrc, vlist, betList, k, s)
			    | InitializeBetList( vlist, s, k )
			    | Network( vlist, k, s, kp, sp ) ) ) ) ) ) ) ) ) );
	    go?(stake).(
	      (new v in
		(new betList in
		  (new updateBet in
		    (new weightedBet in
		      (new rslt in
			(k!(v,stake,betList,updateBet,weightedBet,rslt)
			| Validator(v, updateBet, weightedBet, vlist, betList, rslt)
			| WeightedAverage(fcheck, updateBet, vsrc, vlist, betList, k, s)
			| InitializeBetList( vlist, s, k )
			| InitializeNetwork( vlist, ask, fcheck )
			) ) ) ) ) ) )
	  } 
	) ) ) )
and Network( vlist, k, s, kp, sp ) = 
    vlist?( kpp, spp ).
      select{
	s?(v,stake,betList,updateBet,weightedBet,rslt).(
	  spp!(v,stake,betList,updateBet,weightedBet,rslt)
	| sp!(v,stake,betList,updateBet,weightedBet,rslt)
	| Network( vlist, kp, sp, k, s ) );
	k?(v,stake,betList,updateBet,weightedBet,rslt).(
	  kpp!(v,stake,betList,updateBet,weightedBet,rslt)
	| kp!(v,stake,betList,updateBet,weightedBet,rslt)
	| Network( vlist, k, s, kp, sp )
	)
      };
